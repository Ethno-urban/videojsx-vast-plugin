!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t,i){"use strict";var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,i,r){var n,s,o,a;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),o=s[t]),void 0===o)o=s[t]=i,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),(n=l(e))>0&&o.length>n&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function h(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,s(this.listener,this.target,e))}function d(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=h.bind(r);return n.listener=i,r.wrapFn=n,n}function p(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):f(n,n.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=n[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var l=c.length,u=f(c,l);for(i=0;i<l;++i)s(u[i],this,t)}return!0},a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var i,r,n,s,o;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t){e.exports=videojs},function(e,t,i){"use strict";function r(){}var n={};function s(e){var t=n[e];t&&(clearTimeout(t),delete n[e])}function o(e,t,i){var r=document.createElement("iframe");return r.src=t||"about:blank",r.marginWidth="0",r.marginHeight="0",r.frameBorder="0",r.width="100%",r.height="100%",a(r),i&&(r.style.zIndex=i),r.setAttribute("SCROLLING","NO"),e.innerHTML="",e.appendChild(r),r}function a(e){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.margin="0px",e.style.padding="0px",e.style.border="none",e.style.width="100%",e.style.height="100%"}function c(e,t){return Object.keys(t).forEach((function(i){var r="object"==typeof r?JSON.stringify(t[i]):t[i];e=e.replace(new RegExp("{{"+i+"}}","g"),r)})),e}function l(e,t){var i=e.contentWindow&&e.contentWindow.document;return!!i&&(i.write(t),!0)}e.exports={noop:r,validate:function(e,t){return e?null:new Error(t)},clearCallbackTimeout:s,callbackTimeout:function(e,t,i){var o,a;return a=setTimeout((function(){t=r,delete a[o],i()}),e),n[o=function(){t.apply(this,arguments)&&s(o)}]=a,o},createElementInEl:function(e,t,i){var r=document.createElement(t);return i&&(r.id=i),e.appendChild(r),r},createIframeWithContent:function(e,t,i){var r=o(e,null,i.zIndex);if(l(r,c(t,i)))return r},createIframe:o,setFullSizeStyle:a,simpleTemplate:c,setIframeContent:l,extend:function(e,t){return Object.keys(t).forEach((function(i){e[i]=t[i]})),e},unique:function(e){var t=-1;return function(){return e+"_"+ ++t}}}},function(e,t,i){"use strict";var r=i(2),n=r.unique("vpaidIframe"),s=i(5);function o(e,t,i,s){i=i||{},this._id=n(),this._destroyed=!1,this._frameContainer=r.createElementInEl(e,"div"),this._videoEl=t,this._vpaidOptions=s||{timeout:1e4},this._templateConfig={template:i.template||'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');<\/script></body></html>',extraOptions:i.extraOptions||{}}}function a(e){var t=this[e];t&&(t.remove(),delete this[e])}function c(){u.call(this),delete this._adUnit}function l(){u.call(this),d.call(this)}function u(){a.call(this,"_frame"),h.call(this)}function h(){this._onLoad&&(window.removeEventListener("message",this._onLoad),r.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function d(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function p(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function m(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}o.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,l.call(this))},o.prototype.isDestroyed=function(){return this._destroyed},o.prototype.loadAdUnit=function(e,t){p.call(this),l.call(this);var i=this,n=r.createIframeWithContent(this._frameContainer,this._templateConfig.template,r.extend({iframeURL_JS:e,iframeID:this.getID(),origin:m()},this._templateConfig.extraOptions));this._frame=n,this._onLoad=r.callbackTimeout(this._vpaidOptions.timeout,function(e){if(e.origin!==m())return;var n,o,a;if(JSON.parse(e.data).id!==i.getID())return;i._frame.contentWindow?(a=i._frame.contentWindow.getVPAIDAd,o=r.validate("function"==typeof a,"the ad didn't return a function to create an ad")):o="the iframe is not anymore in the DOM tree";if(!o){var l=i._frame.contentWindow.document.querySelector(".ad-element");(n=new s(a(),l,i._videoEl,i._frame)).subscribe("AdStopped",c.bind(i)),o=r.validate(n.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return i._adUnit=n,h.call(i),t(o,o?null:n),!0}.bind(this),function(){t("timeout",null)}.bind(this)),window.addEventListener("message",this._onLoad)},o.prototype.unloadAdUnit=function(){l.call(this)},o.prototype.getID=function(){return this._id},e.exports=o},function(e,t,i){i(9),e.exports=i(8)},function(e,t,i){"use strict";var r=i(6),n=i(7),s=r.checkVPAIDInterface,o=i(2),a=(r.METHODS,r.EVENTS.filter((function(e){return"AdClickThru"!=e})));function c(e,t,i,r){this._isValid=s(e),this._isValid&&(this._creative=e,this._el=t,this._videoEl=i,this._iframe=r,this._subscribers=new n,o.setFullSizeStyle(t),l.call(this))}function l(){if(a.forEach(function(e){this._creative.subscribe(h.bind(this,e),e)}.bind(this)),this._creative.subscribe(u.bind(this),"AdClickThru"),this._videoEl){var e=this._iframe.contentDocument.documentElement,t=this._videoEl;e.addEventListener("click",(function(i){i.target===e&&t.click()}))}}function u(e,t,i){this._subscribers.triggerSync("AdClickThru",{url:e,id:t,playerHandles:i})}function h(e){this._subscribers.trigger(e,Array.prototype.slice(arguments,1))}function d(e,t,i,r){e?e(i,r):i&&t.trigger("AdError",i)}c.prototype=Object.create(r.prototype),c.prototype.isValidVPAIDAd=function(){return this._isValid},r.METHODS.forEach((function(e){-1===["subscribe","unsubscribe","initAd"].indexOf(e)&&(c.prototype[e]=function(){var t=r.prototype[e].length,i=Array.prototype.slice.call(arguments),n=t===i.length?i.pop():void 0;setTimeout(function(){var t,r=null;try{t=this._creative[e].apply(this._creative,i)}catch(e){r=e}d(n,this._subscribers,r,t)}.bind(this),0)})})),c.prototype.initAd=function(e,t,i,r,n,s,a){n=n||{},s=o.extend({slot:this._el,videoSlot:this._videoEl},s||{}),setTimeout(function(){var o;try{this._creative.initAd(e,t,i,r,n,s)}catch(e){o=e}d(a,this._subscribers,o)}.bind(this),0)},c.prototype.subscribe=function(e,t,i){this._subscribers.subscribe(t,e,i)},c.prototype.unsubscribe=function(e,t){this._subscribers.unsubscribe(t,e)},c.prototype.on=c.prototype.subscribe,c.prototype.off=c.prototype.unsubscribe,r.GETTERS.forEach((function(e){c.prototype[e]=function(t){setTimeout(function(){var i,r=null;try{i=this._creative[e]()}catch(e){r=e}d(t,this._subscribers,r,i)}.bind(this),0)}})),c.prototype.setAdVolume=function(e,t){setTimeout(function(){var i,r=null;try{this._creative.setAdVolume(e),i=this._creative.getAdVolume()}catch(e){r=e}r||(r=o.validate(i===e,"failed to apply volume: "+e)),d(t,this._subscribers,r,i)}.bind(this),0)},c.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},e.exports=c},function(e,t,i){"use strict";var r=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];function n(e,t,i){}n.prototype.handshakeVersion=function(e,t){},n.prototype.initAd=function(e,t,i,r,n,s,o){},n.prototype.startAd=function(e){},n.prototype.stopAd=function(e){},n.prototype.skipAd=function(e){},n.prototype.resizeAd=function(e,t,i,r){},n.prototype.pauseAd=function(e){},n.prototype.resumeAd=function(e){},n.prototype.expandAd=function(e){},n.prototype.collapseAd=function(e){},n.prototype.subscribe=function(e,t,i){},n.prototype.unsubscribe=function(e,t){},n.prototype.getAdLinear=function(e){},n.prototype.getAdWidth=function(e){},n.prototype.getAdHeight=function(e){},n.prototype.getAdExpanded=function(e){},n.prototype.getAdSkippableState=function(e){},n.prototype.getAdRemainingTime=function(e){},n.prototype.getAdDuration=function(e){},n.prototype.getAdVolume=function(e){},n.prototype.getAdCompanions=function(e){},n.prototype.getAdIcons=function(e){},n.prototype.setAdVolume=function(e,t){},o(n,"METHODS",r),o(n,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),o(n,"SETTERS",["setAdVolume"]),o(n,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var s=r.filter((function(e){return-1===["skipAd"].indexOf(e)}));function o(e,t,i){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:i})}o(n,"checkVPAIDInterface",(function(e){return s.every((function(t){return"function"==typeof e[t]}))})),e.exports=n},function(e,t,i){"use strict";function r(){this._subscribers={}}r.prototype.subscribe=function(e,t,i){this.isHandlerAttached(e,t)||this.get(t).push({handler:e,context:i,eventName:t})},r.prototype.unsubscribe=function(e,t){this._subscribers[t]=this.get(t).filter((function(t){return e!==t.handler}))},r.prototype.unsubscribeAll=function(){this._subscribers={}},r.prototype.trigger=function(e,t){var i=this;this.get(e).concat(this.get("*")).forEach((function(e){setTimeout((function(){i.isHandlerAttached(e.handler,e.eventName)&&e.handler.call(e.context,t)}),0)}))},r.prototype.triggerSync=function(e,t){this.get(e).concat(this.get("*")).forEach((function(e){e.handler.call(e.context,t)}))},r.prototype.get=function(e){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e]},r.prototype.isHandlerAttached=function(e,t){return this.get(t).some((function(t){return e===t.handler}))},e.exports=r},function(e,t,i){},function(e,t,i){"use strict";i.r(t);var r=i(1),n=i.n(r);class s{constructor(){this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}}class o{constructor(){this.attributes={},this.children=[]}}class a{constructor(){this.name=null,this.value=null,this.attributes={}}}class c{constructor(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}}}class l{constructor(e={}){this.id=e.id||null,this.adId=e.adId||null,this.sequence=e.sequence||null,this.apiFramework=e.apiFramework||null,this.trackingEvents={}}}class u extends l{constructor(e={}){super(e),this.type="companion",this.variations=[]}}function h(e,t={},i={}){const r=[];t.ASSETURI&&(t.ASSETURI=d(t.ASSETURI)),t.CONTENTPLAYHEAD&&(t.CONTENTPLAYHEAD=d(t.CONTENTPLAYHEAD)),!t.ERRORCODE||i.isCustomCode||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=p(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=d((new Date).toISOString()),t.RANDOM=t.random=t.CACHEBUSTING;for(const i in e){let n=e[i];if("string"==typeof n){for(const e in t){const i=t[e],r=`[${e}]`,s=`%%${e}%%`;n=n.replace(r,i),n=n.replace(s,i)}r.push(n)}}return r}function d(e){return encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16)}`)}function p(e){return e.length<8?m(0,8-e.length,!1).map(()=>"0").join("")+e:e}function m(e,t,i){const r=[],n=e<t,s=i?n?t+1:t-1:t;for(let t=e;n?t<s:t>s;n?t++:t--)r.push(t);return r}const f={track:function(e,t,i){h(e,t,i).forEach(e=>{if("undefined"!=typeof window&&null!==window){(new Image).src=e}})},resolveURLTemplates:h,encodeURIComponentRFC3986:d,leftpad:p,range:m,isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},flatten:function e(t){return t.reduce((t,i)=>t.concat(Array.isArray(i)?e(i):i),[])}};const g={childByName:function(e,t){const i=e.childNodes;for(const e in i){const r=i[e];if(r.nodeName===t)return r}},childrenByName:function(e,t){const i=[],r=e.childNodes;for(const e in r){const n=r[e];n.nodeName===t&&i.push(n)}return i},resolveVastAdTagURI:function(e,t){if(!t)return e;if(0===e.indexOf("//")){const{protocol:t}=location;return`${t}${e}`}if(-1===e.indexOf("://")){return`${t.slice(0,t.lastIndexOf("/"))}/${e}`}return e},parseBoolean:function(e){return-1!==["true","TRUE","1"].indexOf(e)},parseNodeText:function(e){return e&&(e.textContent||e.text||"").trim()},copyNodeAttribute:function(e,t,i){const r=t.getAttribute(e);r&&i.setAttribute(e,r)},parseDuration:function(e){if(null==e)return-1;if(f.isNumeric(e))return parseInt(e);const t=e.split(":");if(3!==t.length)return-1;const i=t[2].split(".");let r=parseInt(i[0]);2===i.length&&(r+=parseFloat(`0.${i[1]}`));const n=parseInt(60*t[1]),s=parseInt(60*t[0]*60);return isNaN(s)||isNaN(n)||isNaN(r)||n>3600||r>60?-1:s+n+r},splitVAST:function(e){const t=[];let i=null;return e.forEach((r,n)=>{if(r.sequence&&(r.sequence=parseInt(r.sequence,10)),r.sequence>1){const t=e[n-1];if(t&&t.sequence===r.sequence-1)return void(i&&i.push(r));delete r.sequence}i=[r],t.push(i)}),t},mergeWrapperAdData:function(e,t){e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),e.creatives.forEach(e=>{if(t.trackingEvents&&t.trackingEvents[e.type])for(const i in t.trackingEvents[e.type]){const r=t.trackingEvents[e.type][i];Array.isArray(e.trackingEvents[i])||(e.trackingEvents[i]=[]),e.trackingEvents[i]=e.trackingEvents[i].concat(r)}}),t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length&&e.creatives.forEach(e=>{"linear"===e.type&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates))}),t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length&&e.creatives.forEach(e=>{"linear"===e.type&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates))}),t.videoClickThroughURLTemplate&&e.creatives.forEach(e=>{"linear"!==e.type||null!==e.videoClickThroughURLTemplate&&void 0!==e.videoClickThroughURLTemplate||(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)})}};function v(e,t){const i=new u(t);return g.childrenByName(e,"Companion").forEach(e=>{const t=new c;t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.companionClickTrackingURLTemplates=[],g.childrenByName(e,"HTMLResource").forEach(e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=g.parseNodeText(e)}),g.childrenByName(e,"IFrameResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=g.parseNodeText(e)}),g.childrenByName(e,"StaticResource").forEach(i=>{t.type=i.getAttribute("creativeType")||0,g.childrenByName(e,"AltText").forEach(e=>{t.altText=g.parseNodeText(e)}),t.staticResource=g.parseNodeText(i)}),g.childrenByName(e,"TrackingEvents").forEach(e=>{g.childrenByName(e,"Tracking").forEach(e=>{const i=e.getAttribute("event"),r=g.parseNodeText(e);i&&r&&(Array.isArray(t.trackingEvents[i])||(t.trackingEvents[i]=[]),t.trackingEvents[i].push(r))})}),g.childrenByName(e,"CompanionClickTracking").forEach(e=>{t.companionClickTrackingURLTemplates.push(g.parseNodeText(e))}),t.companionClickThroughURLTemplate=g.parseNodeText(g.childByName(e,"CompanionClickThrough")),t.companionClickTrackingURLTemplate=g.parseNodeText(g.childByName(e,"CompanionClickTracking")),i.variations.push(t)}),i}class y extends l{constructor(e={}){super(e),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}}class T{constructor(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null}}class A{constructor(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}}function k(e,t){let i;const r=new y(t);r.duration=g.parseDuration(g.parseNodeText(g.childByName(e,"Duration")));const n=e.getAttribute("skipoffset");if(null==n)r.skipDelay=null;else if("%"===n.charAt(n.length-1)&&-1!==r.duration){const e=parseInt(n,10);r.skipDelay=r.duration*(e/100)}else r.skipDelay=g.parseDuration(n);const s=g.childByName(e,"VideoClicks");s&&(r.videoClickThroughURLTemplate=g.parseNodeText(g.childByName(s,"ClickThrough")),g.childrenByName(s,"ClickTracking").forEach(e=>{r.videoClickTrackingURLTemplates.push(g.parseNodeText(e))}),g.childrenByName(s,"CustomClick").forEach(e=>{r.videoCustomClickURLTemplates.push(g.parseNodeText(e))}));const o=g.childByName(e,"AdParameters");o&&(r.adParameters=g.parseNodeText(o)),g.childrenByName(e,"TrackingEvents").forEach(e=>{g.childrenByName(e,"Tracking").forEach(e=>{let t=e.getAttribute("event");const n=g.parseNodeText(e);if(t&&n){if("progress"===t){if(i=e.getAttribute("offset"),!i)return;t="%"===i.charAt(i.length-1)?`progress-${i}`:`progress-${Math.round(g.parseDuration(i))}`}Array.isArray(r.trackingEvents[t])||(r.trackingEvents[t]=[]),r.trackingEvents[t].push(n)}})}),g.childrenByName(e,"MediaFiles").forEach(e=>{g.childrenByName(e,"MediaFile").forEach(e=>{const t=new A;t.id=e.getAttribute("id"),t.fileURL=g.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.apiFramework=e.getAttribute("apiFramework"),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0);let i=e.getAttribute("scalable");i&&"string"==typeof i&&(i=i.toLowerCase(),"true"===i?t.scalable=!0:"false"===i&&(t.scalable=!1));let n=e.getAttribute("maintainAspectRatio");n&&"string"==typeof n&&(n=n.toLowerCase(),"true"===n?t.maintainAspectRatio=!0:"false"===n&&(t.maintainAspectRatio=!1)),r.mediaFiles.push(t)})});const a=g.childByName(e,"Icons");return a&&g.childrenByName(a,"Icon").forEach(e=>{const t=new T;t.program=e.getAttribute("program"),t.height=parseInt(e.getAttribute("height")||0),t.width=parseInt(e.getAttribute("width")||0),t.xPosition=function(e){if(-1!==["left","right"].indexOf(e))return e;return parseInt(e||0)}(e.getAttribute("xPosition")),t.yPosition=function(e){if(-1!==["top","bottom"].indexOf(e))return e;return parseInt(e||0)}(e.getAttribute("yPosition")),t.apiFramework=e.getAttribute("apiFramework"),t.offset=g.parseDuration(e.getAttribute("offset")),t.duration=g.parseDuration(e.getAttribute("duration")),g.childrenByName(e,"HTMLResource").forEach(e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=g.parseNodeText(e)}),g.childrenByName(e,"IFrameResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=g.parseNodeText(e)}),g.childrenByName(e,"StaticResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.staticResource=g.parseNodeText(e)});const i=g.childByName(e,"IconClicks");i&&(t.iconClickThroughURLTemplate=g.parseNodeText(g.childByName(i,"IconClickThrough")),g.childrenByName(i,"IconClickTracking").forEach(e=>{t.iconClickTrackingURLTemplates.push(g.parseNodeText(e))})),t.iconViewTrackingURLTemplate=g.parseNodeText(g.childByName(e,"IconViewTracking")),r.icons.push(t)}),r}class b extends l{constructor(e={}){super(e),this.type="nonlinear",this.variations=[]}}class R{constructor(){this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null}}function L(e,t){const i=new b(t);return g.childrenByName(e,"TrackingEvents").forEach(e=>{let t,r;g.childrenByName(e,"Tracking").forEach(e=>{t=e.getAttribute("event"),r=g.parseNodeText(e),t&&r&&(Array.isArray(i.trackingEvents[t])||(i.trackingEvents[t]=[]),i.trackingEvents[t].push(r))})}),g.childrenByName(e,"NonLinear").forEach(e=>{const t=new R;t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.expandedWidth=e.getAttribute("expandedWidth"),t.expandedHeight=e.getAttribute("expandedHeight"),t.scalable=g.parseBoolean(e.getAttribute("scalable")),t.maintainAspectRatio=g.parseBoolean(e.getAttribute("maintainAspectRatio")),t.minSuggestedDuration=g.parseDuration(e.getAttribute("minSuggestedDuration")),t.apiFramework=e.getAttribute("apiFramework"),g.childrenByName(e,"HTMLResource").forEach(e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=g.parseNodeText(e)}),g.childrenByName(e,"IFrameResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=g.parseNodeText(e)}),g.childrenByName(e,"StaticResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.staticResource=g.parseNodeText(e)});const r=g.childByName(e,"AdParameters");r&&(t.adParameters=g.parseNodeText(r)),t.nonlinearClickThroughURLTemplate=g.parseNodeText(g.childByName(e,"NonLinearClickThrough")),g.childrenByName(e,"NonLinearClickTracking").forEach(e=>{t.nonlinearClickTrackingURLTemplates.push(g.parseNodeText(e))}),i.variations.push(t)}),i}function E(e){const t=e.childNodes;for(const i in t){const r=t[i];if(-1!==["Wrapper","InLine"].indexOf(r.nodeName)){if(g.copyNodeAttribute("id",e,r),g.copyNodeAttribute("sequence",e,r),"Wrapper"===r.nodeName)return C(r);if("InLine"===r.nodeName)return w(r)}}}function w(e){const t=e.childNodes,i=new s;i.id=e.getAttribute("id")||null,i.sequence=e.getAttribute("sequence")||null;for(const e in t){const r=t[e];switch(r.nodeName){case"Error":i.errorURLTemplates.push(g.parseNodeText(r));break;case"Impression":i.impressionURLTemplates.push(g.parseNodeText(r));break;case"Creatives":g.childrenByName(r,"Creative").forEach(e=>{const t={id:e.getAttribute("id")||null,adId:x(e),sequence:e.getAttribute("sequence")||null,apiFramework:e.getAttribute("apiFramework")||null};for(const r in e.childNodes){const n=e.childNodes[r];let s;switch(n.nodeName){case"Linear":s=k(n,t),s&&i.creatives.push(s);break;case"NonLinearAds":s=L(n,t),s&&i.creatives.push(s);break;case"CompanionAds":s=v(n,t),s&&i.creatives.push(s)}}});break;case"Extensions":U(i.extensions,g.childrenByName(r,"Extension"));break;case"AdSystem":i.system={value:g.parseNodeText(r),version:r.getAttribute("version")||null};break;case"AdTitle":i.title=g.parseNodeText(r);break;case"Description":i.description=g.parseNodeText(r);break;case"Advertiser":i.advertiser=g.parseNodeText(r);break;case"Pricing":i.pricing={value:g.parseNodeText(r),model:r.getAttribute("model")||null,currency:r.getAttribute("currency")||null};break;case"Survey":i.survey=g.parseNodeText(r)}}return i}function C(e){const t=w(e);let i=g.childByName(e,"VASTAdTagURI");if(i?t.nextWrapperURL=g.parseNodeText(i):(i=g.childByName(e,"VASTAdTagURL"),i&&(t.nextWrapperURL=g.parseNodeText(g.childByName(i,"URL")))),t.creatives.forEach(e=>{if(-1!==["linear","nonlinear"].indexOf(e.type)){if(e.trackingEvents){t.trackingEvents||(t.trackingEvents={}),t.trackingEvents[e.type]||(t.trackingEvents[e.type]={});for(const i in e.trackingEvents){const r=e.trackingEvents[i];Array.isArray(t.trackingEvents[e.type][i])||(t.trackingEvents[e.type][i]=[]),r.forEach(r=>{t.trackingEvents[e.type][i].push(r)})}}e.videoClickTrackingURLTemplates&&(Array.isArray(t.videoClickTrackingURLTemplates)||(t.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach(e=>{t.videoClickTrackingURLTemplates.push(e)})),e.videoClickThroughURLTemplate&&(t.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(Array.isArray(t.videoCustomClickURLTemplates)||(t.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach(e=>{t.videoCustomClickURLTemplates.push(e)}))}}),t.nextWrapperURL)return t}function U(e,t){t.forEach(t=>{const i=new o,r=t.attributes,n=t.childNodes;if(t.attributes)for(const e in r){const t=r[e];t.nodeName&&t.nodeValue&&(i.attributes[t.nodeName]=t.nodeValue)}for(const e in n){const t=n[e],r=g.parseNodeText(t);if("#comment"!==t.nodeName&&""!==r){const e=new a;if(e.name=t.nodeName,e.value=r,t.attributes){const i=t.attributes;for(const t in i){const r=i[t];e.attributes[r.nodeName]=r.nodeValue}}i.children.push(e)}}e.push(i)})}function x(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null}var N=i(0);function S(){let e;return window.XDomainRequest&&(e=new XDomainRequest),e}const _={get:function(e,t,i){const r="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0;if(!r)return i(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"));r.async=!1;const n=S();n.open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.send(),n.onprogress=function(){},n.onload=function(){r.loadXML(n.responseText),i(null,r)}},supported:function(){return!!S()}};const I={get:function(e,t,i){i(new Error("Please bundle the library for node to use the node urlHandler"))}};function O(){try{const e=new window.XMLHttpRequest;return"withCredentials"in e?e:null}catch(e){return null}}const D={get:function(e,t,i){if("https:"===window.location.protocol&&0===e.indexOf("http://"))return i(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{const r=O();r.open("GET",e),r.timeout=t.timeout||0,r.withCredentials=t.withCredentials||!1,r.overrideMimeType&&r.overrideMimeType("text/xml"),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?i(null,r.responseXML):i(new Error(`XHRURLHandler: ${r.statusText}`)))},r.send()}catch(e){i(new Error("XHRURLHandler: Unexpected error"))}},supported:function(){return!!O()}};const V={get:function(e,t,i){return i||("function"==typeof t&&(i=t),t={}),"undefined"==typeof window||null===window?I.get(e,t,i):D.supported()?D.get(e,t,i):_.supported()?_.get(e,t,i):i(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}};class P{constructor(){this.ads=[],this.errorURLTemplates=[],this.version=null}}const B={ERRORCODE:900,extensions:[]};class F extends N.EventEmitter{constructor(){super(),this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=null,this.URLTemplateFilters=[],this.fetchingOptions={}}addURLTemplateFilter(e){"function"==typeof e&&this.URLTemplateFilters.push(e)}removeURLTemplateFilter(){this.URLTemplateFilters.pop()}countURLTemplateFilters(){return this.URLTemplateFilters.length}clearURLTemplateFilters(){this.URLTemplateFilters=[]}trackVastError(e,t,...i){this.emit("VAST-error",Object.assign({},B,t,...i)),f.track(e,t)}getErrorURLTemplates(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}fetchVAST(e,t,i){return new Promise((r,n)=>{this.URLTemplateFilters.forEach(t=>{e=t(e)}),this.parentURLs.push(e),this.emit("VAST-resolving",{url:e,wrapperDepth:t,originalUrl:i}),this.urlHandler.get(e,this.fetchingOptions,(t,i)=>{this.emit("VAST-resolved",{url:e,error:t}),t?n(t):r(i)})})}initParsingStatus(e={}){this.rootURL="",this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=e.wrapperLimit||10,this.fetchingOptions={timeout:e.timeout,withCredentials:e.withCredentials},this.urlHandler=e.urlHandler||e.urlhandler||V,this.vastVersion=null}getRemainingAds(e){if(0===this.remainingAds.length)return Promise.reject(new Error("No more ads are available for the given VAST"));const t=e?f.flatten(this.remainingAds):this.remainingAds.shift();return this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(t,{wrapperDepth:0,originalUrl:this.rootURL}).then(e=>this.buildVASTResponse(e))}getAndParseVAST(e,t={}){return this.initParsingStatus(t),this.rootURL=e,this.fetchVAST(e).then(i=>(t.originalUrl=e,t.isRootVAST=!0,this.parse(i,t).then(e=>this.buildVASTResponse(e))))}parseVAST(e,t={}){return this.initParsingStatus(t),t.isRootVAST=!0,this.parse(e,t).then(e=>this.buildVASTResponse(e))}buildVASTResponse(e){const t=new P;return t.ads=e,t.errorURLTemplates=this.getErrorURLTemplates(),t.version=this.vastVersion,this.completeWrapperResolving(t),t}parseVastXml(e,{isRootVAST:t=!1}){if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)throw new Error("Invalid VAST XMLDocument");const i=[],r=e.documentElement.childNodes;if(t){const t=e.documentElement.getAttribute("version");t&&(this.vastVersion=t)}for(const e in r){const n=r[e];if("Error"===n.nodeName){const e=g.parseNodeText(n);t?this.rootErrorURLTemplates.push(e):this.errorURLTemplates.push(e)}if("Ad"===n.nodeName){const e=E(n);e?i.push(e):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101})}}return i}parse(e,{resolveAll:t=!0,wrapperSequence:i=null,originalUrl:r=null,wrapperDepth:n=0,isRootVAST:s=!1}){let o=[];try{o=this.parseVastXml(e,{isRootVAST:s})}catch(e){return Promise.reject(e)}const a=o.length,c=o[a-1];return 1===a&&null!=i&&c&&!c.sequence&&(c.sequence=i),!1===t&&(this.remainingAds=g.splitVAST(o),o=this.remainingAds.shift()),this.resolveAds(o,{wrapperDepth:n,originalUrl:r})}resolveAds(e=[],{wrapperDepth:t,originalUrl:i}){const r=[];return e.forEach(e=>{const n=this.resolveWrappers(e,t,i);r.push(n)}),Promise.all(r).then(e=>{const r=f.flatten(e);if(!r&&this.remainingAds.length>0){const e=this.remainingAds.shift();return this.resolveAds(e,{wrapperDepth:t,originalUrl:i})}return r})}resolveWrappers(e,t,i){return new Promise(r=>{if(t++,!e.nextWrapperURL)return delete e.nextWrapperURL,r(e);if(t>=this.maxWrapperDepth||-1!==this.parentURLs.indexOf(e.nextWrapperURL))return e.errorCode=302,delete e.nextWrapperURL,r(e);e.nextWrapperURL=g.resolveVastAdTagURI(e.nextWrapperURL,i);const n=e.sequence;i=e.nextWrapperURL,this.fetchVAST(e.nextWrapperURL,t,i).then(s=>this.parse(s,{originalUrl:i,wrapperSequence:n,wrapperDepth:t}).then(t=>{if(delete e.nextWrapperURL,0===t.length)return e.creatives=[],r(e);t.forEach(t=>{t&&g.mergeWrapperAdData(t,e)}),r(t)})).catch(t=>{e.errorCode=301,e.errorMessage=t.message,r(e)})})}completeWrapperResolving(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ERRORCODE:303});else for(let t=e.ads.length-1;t>=0;t--){const i=e.ads[t];(i.errorCode||0===i.creatives.length)&&(this.trackVastError(i.errorURLTemplates.concat(e.errorURLTemplates),{ERRORCODE:i.errorCode||303},{ERRORMESSAGE:i.errorMessage||""},{extensions:i.extensions},{system:i.system}),e.ads.splice(t,1))}}}let M=null;const j={data:{},length:0,getItem(e){return this.data[e]},setItem(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem(e){delete this.data[e],this.length=Object.keys(this.data).length},clear(){this.data={},this.length=0}};class H{constructor(){this.storage=this.initStorage()}initStorage(){if(M)return M;try{M="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){M=null}return M&&!this.isStorageDisabled(M)||(M=j,M.clear()),M}isStorageDisabled(e){const t="__VASTStorage__";try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1}getItem(e){return this.storage.getItem(e)}setItem(e,t){return this.storage.setItem(e,t)}removeItem(e){return this.storage.removeItem(e)}clear(){return this.storage.clear()}}class W{constructor(e,t,i){this.cappingFreeLunch=e||0,this.cappingMinimumTimeInterval=t||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new F,this.storage=i||new H,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}getParser(){return this.vastParser}get lastSuccessfulAd(){return this.storage.getItem("vast-client-last-successful-ad")}set lastSuccessfulAd(e){this.storage.setItem("vast-client-last-successful-ad",e)}get totalCalls(){return this.storage.getItem("vast-client-total-calls")}set totalCalls(e){this.storage.setItem("vast-client-total-calls",e)}get totalCallsTimeout(){return this.storage.getItem("vast-client-total-calls-timeout")}set totalCallsTimeout(e){this.storage.setItem("vast-client-total-calls-timeout",e)}hasRemainingAds(){return this.vastParser.remainingAds.length>0}getNextAds(e){return this.vastParser.getRemainingAds(e)}get(e,t={}){const i=Date.now();return(t=Object.assign({},this.defaultOptions,t)).hasOwnProperty("resolveAll")||(t.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise((r,n)=>{if(this.cappingFreeLunch>=this.totalCalls)return n(new Error(`VAST call canceled – FreeLunch capping not reached yet ${this.totalCalls}/${this.cappingFreeLunch}`));const s=i-this.lastSuccessfulAd;if(s<0)this.lastSuccessfulAd=0;else if(s<this.cappingMinimumTimeInterval)return n(new Error(`VAST call canceled – (${this.cappingMinimumTimeInterval})ms minimum interval reached`));this.vastParser.getAndParseVAST(e,t).then(e=>r(e)).catch(e=>n(e))})}}class q extends N.EventEmitter{constructor(e,t,i,r=null){super(),this.ad=t,this.creative=i,this.variation=r,this.muted=!1,this.impressed=!1,this.skippable=!1,this.trackingEvents={},this._alreadyTriggeredQuartiles={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"];for(const e in this.creative.trackingEvents){const t=this.creative.trackingEvents[e];this.trackingEvents[e]=t.slice(0)}this.creative instanceof y?this._initLinearTracking():this._initVariationTracking(),e&&this.on("start",()=>{e.lastSuccessfulAd=Date.now()})}_initLinearTracking(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}_initVariationTracking(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(const e in this.variation.trackingEvents){const t=this.variation.trackingEvents[e];this.trackingEvents[e]?this.trackingEvents[e]=this.trackingEvents[e].concat(t.slice(0)):this.trackingEvents[e]=t.slice(0)}this.variation instanceof R?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):this.variation instanceof c&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}}setDuration(e){this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}}setProgress(e){const t=this.skipDelay||-1;if(-1===t||this.skippable||(t>e?this.emit("skip-countdown",t-e):(this.skippable=!0,this.emit("skip-countdown",0))),this.assetDuration>0){const t=[];if(e>0){const i=Math.round(e/this.assetDuration*100);t.push("start"),t.push(`progress-${i}%`),t.push(`progress-${Math.round(e)}`);for(const i in this.quartiles)this.isQuartileReached(i,this.quartiles[i],e)&&(t.push(i),this._alreadyTriggeredQuartiles[i]=!0)}t.forEach(e=>{this.track(e,!0)}),e<this.progress&&this.track("rewind")}this.progress=e}isQuartileReached(e,t,i){let r=!1;return t<=i&&!this._alreadyTriggeredQuartiles[e]&&(r=!0),r}setMuted(e){this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e}setPaused(e){this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e}setFullscreen(e){this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen"),this.fullscreen=e}setExpand(e){this.expanded!==e&&this.track(e?"expand":"collapse"),this.expanded=e}setSkipDelay(e){"number"==typeof e&&(this.skipDelay=e)}trackImpression(){this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView"))}errorWithCode(e,t=!1){this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e},{isCustomCode:t})}complete(){this.track("complete")}close(){this.track(this.linear?"closeLinear":"close")}skip(){this.track("skip")}click(e=null){this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates);const t=this.clickThroughURLTemplate||e;if(t){const e=this.linear?{CONTENTPLAYHEAD:this.progressFormatted()}:{},i=f.resolveURLTemplates([t],e)[0];this.emit("clickthrough",i)}}track(e,t=!1){"closeLinear"===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e="close");const i=this.trackingEvents[e],r=this.emitAlwaysEvents.indexOf(e)>-1;i?(this.emit(e,""),this.trackURLs(i)):r&&this.emit(e,""),t&&(delete this.trackingEvents[e],r&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1))}trackURLs(e,t={},i={}){this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(t.ASSETURI=this.creative.mediaFiles[0].fileURL),t.CONTENTPLAYHEAD=this.progressFormatted()),f.track(e,t,i)}progressFormatted(){const e=parseInt(this.progress);let t=e/3600;t.length<2&&(t=`0${t}`);let i=e/60%60;i.length<2&&(i=`0${i}`);let r=e%60;return r.length<2&&(r=`0${i}`),`${t}:${i}:${r}.${parseInt(100*(this.progress-e))}`}}var $=i(3),X=i.n($);function z(e,t,i){const r=["application/x-javascript","text/javascript","application/javascript"],n=t.mediaFiles.find(e=>"VPAID"===e.apiFramework&&(e=>r.indexOf(e.mimeType.trim())>-1)(e));if(!n)return console.warn("Only JavaScript VPAID is supported by this player"),void this.player.trigger("adscanceled");const s=e.el().querySelector(".vjs-tech"),o=document.createElement("div");o.className=i.vpaid.containerClass,o.id=i.vpaid.containerId,e.el().insertBefore(o,e.controlBar.el());const a=new X.a(o,s,{});e.ads.startLinearAdMode(),e.pause(),e.controlBar.hide(),a.loadAdUnit(n.fileURL,(function(r,n){if(r)return console.error(r),e.controlBar.show(),void e.trigger("aderror");let s;function c(){const t=Q(e);n.resizeAd(t.width,t.height,e.isFullscreen()?"fullscreen":"normal")}n.handshakeVersion("2.0",(function(r,a){const c=Q(e),l={AdParameters:t.adParameters},u=i.vpaid.videoInstance;"same"===u?s=e.tech({kindaKnowWhatImDoing:!0}).el():"new"===u?(s=document.createElement("video"),s.style.cssText="position:absolute; top:0; left:0; z-index:2 !important;",o.appendChild(s)):("none"!==u&&console.warn(u+" is an invalid videoInstance value. Defaulting to 'none'."),s=null);const h={slot:o,videoSlot:s};n.initAd(c.width,c.height,"normal",-1,l,h)})),n.subscribe("AdLoaded",(function(){n.startAd()})),n.subscribe("AdStarted",(function(){e.trigger("ads-ad-started"),e.on("resize",c),window.addEventListener("resize",c)})),n.subscribe("AdStopped",(function(){a.destroy(),e.controlBar.show(),e.off("resize",c),window.removeEventListener("resize",c),e.trigger("adended"),e.ads.endLinearAdMode(),"new"===i.vpaid.videoInstance&&s.parentElement&&s.parentElement.removeChild(s)}))}))}function Q(e){let t=e.width(),i=e.height();return e.isFullscreen()&&(t=window.innerWidth,i=window.innerHeight),{width:t,height:i}}const G=n.a.getPlugin("plugin");const Y=window,J={seekEnabled:!1,controlsEnabled:!1,wrapperLimit:10,withCredentials:!0,skip:0,vpaid:{containerId:void 0,containerClass:"vjs-vpaid-container",videoInstance:"none"}};n.a.registerPlugin("vast",class extends G{constructor(e,t){super(e),"function"==typeof e.ads&&e.ads({debug:!1}),t=n.a.mergeOptions(J,t||{}),this.options=t,this.vastClient=new W,this.originalPlayerState={},this.eventListeners={},this.domElements={},this.vastCreative=null,e.on("contentchanged",()=>{console.log("Content changed")}),e.on("readyforpreroll",()=>{console.log("Trigger read for preroll"),!function(e){const t=e.mediaFiles;for(let e=0;e<t.length;e++)if(t[e].apiFramework&&"VPAID"===t[e].apiFramework)return!0;return!1}(this.vastCreative)?this._doPreroll(this.vastCreative):z(e,this.vastCreative,t)}),this._getVastContent().then(e=>this._handleVast(e)).catch(e=>{this.player.trigger("adscanceled"),console.log(`Ad cancelled: ${e.message}`)})}_handleVast(e){if(!e.ads||0===e.ads.length)return void this.player.trigger("adscanceled");const t=e=>"linear"===e.type,i=e.ads.find(e=>e.creatives.some(t)),r=i.creatives.find(t),n=i.creatives.find(e=>"companion"===e.type),s=this.options;if(s.companion&&n){const e=n.variations.find(e=>e.width===String(s.companion.maxWidth)&&e.height===String(s.companion.maxHeight));if(e&&e.staticResource)if(0===e.type.indexOf("image")){const t=e.companionClickThroughURLTemplate,i=Y.document.getElementById(s.companion.elementId);let r;r=t?`<a href="${t}" target="_blank"><img src="${e.staticResource}"/></a>`:`<img src="${e.staticResource}"/>`,i.innerHTML=r}else["application/x-javascript","text/javascript","application/javascript"].indexOf(e.type)>-1||e.type}this.tracker=new q(this.vastClient,i,r,n),this.vastCreative=r,r.mediaFiles.length?(console.log("Trigger ads ready"),this.player.trigger("adsready")):this.player.trigger("adscanceled")}_getVastContent(){let{url:e,xml:t}=this.options;if(e)return this.vastClient.get(e,{withCredentials:this.options.withCredentials,wrapperLimit:this.options.wrapperLimit});if(t){const e=new F;let i;if(t.constructor===window.XMLDocument)i=t;else{if(t.constructor!==String)throw new Error("xml config option must be a String or XMLDocument");i=(new window.DOMParser).parseFromString(t,"text/xml")}return e.parseVAST(i)}return Promise.reject(new Error("url or xml option not set"))}_doPreroll(e){const t=this.player,i=this.options;t.ads.startLinearAdMode(),this.originalPlayerState.controlsEnabled=t.controls(),t.controls(i.controlsEnabled),this.originalPlayerState.seekEnabled=t.controlBar.progressControl.enabled(),i.seekEnabled?t.controlBar.progressControl.enable():t.controlBar.progressControl.disable(),t.src(e.mediaFiles.map(e=>({type:e.mimeType,src:e.fileURL})));const r=Y.document.createElement("div");r.className="vast-blocker",r.onclick=()=>{if(t.paused())return t.play(),!1;this.tracker.click()},this.tracker.on("clickthrough",e=>{Y.open(e,"_blank")}),this.domElements.blocker=r,t.el().insertBefore(r,t.controlBar.el());const n=Y.document.createElement("div");n.className="vast-skip-button",n.style.display="none",this.domElements.skipButton=n,t.el().appendChild(n),this.eventListeners.adtimeupdate=()=>this._timeUpdate(),t.one("adplay",()=>{this.options.skip>0&&t.duration()>=this.options.skip&&(n.style.display="block",t.on("adtimeupdate",this.eventListeners.adtimeupdate)),this.player.loadingSpinner.el().style.display="none"}),this.eventListeners.teardown=()=>this._tearDown(),n.onclick=e=>{if((" "+n.className+" ").indexOf(" enabled ")>=0&&(this.tracker.skip(),this.eventListeners.teardown()),void 0===Y.Event.prototype.stopPropagation)return!1;e.stopPropagation()},this._setupEvents(),t.one("adended",this.eventListeners.teardown)}_timeUpdate(){const e=this.player;e.loadingSpinner.el().style.display="none";const t=Math.ceil(this.options.skip-e.currentTime());t>0?this.domElements.skipButton.innerHTML="Skip in "+t+"...":-1===(" "+this.domElements.skipButton.className+" ").indexOf(" enabled ")&&(this.domElements.skipButton.className+=" enabled ",this.domElements.skipButton.innerHTML="Skip")}_tearDown(){Object.values(this.domElements).forEach(e=>e.parentNode.removeChild(e));const e=this.player;e.off("adtimeupdate",this.eventListeners.adtimeupdate),e.ads.endLinearAdMode(),e.controls(this.originalPlayerState.controlsEnabled),this.originalPlayerState.seekEnabled?e.controlBar.progressControl.enable():e.controlBar.progressControl.disable(),e.trigger("vast-done")}_setupEvents(){const e=this.player,t=this.tracker;let i=!1;const r=function(){t.trackImpression()},n=function(){isNaN(t.assetDuration)&&(t.assetDuration=e.duration()),t.setProgress(e.currentTime())},s=function(){t.setPaused(!0),e.one("adplay",(function(){t.setPaused(!1)}))},o=function(){t.errorWithCode("405"),i=!0,e.error(null),e.trigger("adended")},a=function(){t.setFullscreen(e.isFullscreen())},c=function(){let i=e.muted(),r=e.volume();return function(){const n=e.volume(),s=e.muted();i!==s?(t.setMuted(s),i=s):r!==n&&(r>0&&0===n?t.setMuted(!0):0===r&&n>0&&t.setMuted(!1),r=n)}}();e.on("adcanplay",r),e.on("adtimeupdate",n),e.on("adpause",s),e.on("aderror",o),e.on("advolumechange",c),e.on("fullscreenchange",a),e.one("vast-done",(function(){e.off("adcanplay",r),e.off("adtimeupdate",n),e.off("adpause",s),e.off("aderror",o),e.off("advolumechange",c),e.off("fullscreenchange",a),i||t.complete()}))}})}]);